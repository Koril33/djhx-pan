{% extends "dashboard.html" %}
{% block head %}
	<link rel="stylesheet" href="{{ url_for('static', filename='css/share.css') }}">
{% endblock %}
{% block title %}分享管理{% endblock %}
{% block content %}
<h1>分享管理</h1>

<table>
    <thead>
        <tr>
            <th>ID</th>
            <th>文件名</th>
            <th>分享链接</th>
            <th>密码</th>
            <th>有效期</th>
            <th>允许下载</th>
            <th>创建时间</th>
            <th>操作</th>
        </tr>
    </thead>
    <tbody>
        {% for s in shares %}
        <tr>
            <form action="{{ url_for('file.update_share', share_id=s.id) }}" method="post">
                <td>{{ s.id }}</td>
                <td>{{ s.filename or '(文件已删除)' }}</td>
                <td><a href="{{ s.share_url }}" target="_blank">{{ s.share_url }}</a></td>
                <td><input type="text" name="password" value="{{ s.password or '' }}"></td>
                <td>
                    <select name="expires_in">
                        <option value="1h">1h</option>
                        <option value="3h">3h</option>
                        <option value="6h">6h</option>
                        <option value="12h">12h</option>
                        <option value="1d">1d</option>
                        <option value="3d">3d</option>
                        <option value="7d">7d</option>
                        <option value="never" {% if not s.expires_at %}selected{% endif %}>永久</option>
                    </select>
                    <div style="font-size:12px; color:#666;">{{ s.expires_display }}</div>
                </td>
                <td><input type="checkbox" name="allow_download" {% if s.allow_download %}checked{% endif %}></td>
                <td>{{ s.created_datetime[:19].replace('T',' ') }}</td>
                <td>
                    <button type="submit">保存</button>
            </form>
            <form action="{{ url_for('file.delete_share', share_id=s.id) }}" method="post">
                <button type="submit" onclick="return confirm('确定删除该分享？')">删除</button>
            </form>
                </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

{% if not shares %}
<p>暂无分享记录。</p>
{% endif %}
{% endblock %}
